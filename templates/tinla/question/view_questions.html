{% extends "web/base.html" %}
{% block extra_css %}
<link rel="stylesheet" type="text/css" href="{{MEDIA_URL}}css/tree.css">
<style type="text/css">
body {font: normal 11px verdana, sans-serif; color: #333; line-height: 19px;}
table {width:100%; margin-bottom:0px !important;}
a { text-decoration: underline; color: #46546C; }
a:hover { text-decoration: underline; color: #4d77c3; }
#tree {width:250px;padding: 10px;float:left;}
</style>
{% endblock %}

{% block content %}

<div class="padding_top10">
<div id="tree"></div>
	<div class="content_head" style="height:34px;">
		<div class="header rc5" style="width: 960px;">
            <div class="left w760">
                <h1>Questions</h1>
            </div>
			<div class="left search_element">
				<form action="" method="get" id="search_form">
				  	{% if q %}
						<input type="text" id="q" name="q" value="{{q}}" autocomplete="off" maxlength="300"/>
					{% else %}
						<input type="text" id="q" name="q" autocomplete="off" maxlength="300" placeholder="Search Question" />
					{% endif %}
				  	<button type="submit" id="go" id="ques_str_submit"></button>
				  <div class="clear"></div>				  
				</form>
			</div>
		</div>
    	<div class="clear bordergray"></div>
  	</div>

	<div class="inner-content">
		<div class="right marb10">
			<a href="/question/add/">+ Add a new Question</a>
		</div>
		<div class="clear mart10">
		<form action="" id="question_list_form" name="question_list_form">
			{% if ques %}
				<div class="mart10">
				<table class="tablesorter tbl_response" cellspacing="0" cellpadding="0" border="0" id="user_table" >
					<thead>
						<tr>
							<th class="w400"><strong>Question</strong></th>
							<th class="w100"><strong>Answer Type</strong></th>
							<th class="w400"><strong>Question Type</strong></th>
							<th class="w30"></th>
						</tr>
					</thead>
					<tbody>
					{% for q in ques %}
						<tr>
							<td class="f11 flgray w375 word-wrap vatop padl10"><a href="/question/{{q.question.id}}" class="ca f11">{{q.question.question}}</a></td>
							<td class="f11 flgray w75 word-wrap vatop padl10">{{q.question.answer_type|title}}</td>
							<td class="f11 flgray w375 word-wrap vatop padl10">{{q.question.type|title}}</td>
							<td class="ca w30"><input type='submit' class='deletebin hide' id='{{q.question.id}}' value='del' /><input type='image' class='deletebin' id='{{q.question.id}}' src="/media/images/dustbin_icon.png" /></td>
						</tr>
					{% endfor %}
					</tbody>
				</table>
			</div>
		{% else %}
			<div class="f15">
				<h2><strong> No questions to display</strong> </h2>
			</div>
		{% endif %}
		</form>
		</div>
	</div>
	<div id='deletebin' style='display:none;'></div>
    <div class="clear"></div>
</div>

{% endblock %}

{% block script_footer %}
{{block.super}}

<script type="text/javascript" src="{{MEDIA_URL}}js/tree-builder/yahoo.js" ></script>
<script type="text/javascript" src="{{MEDIA_URL}}js/tree-builder/event.js"></script>
<script type="text/javascript" src="{{MEDIA_URL}}js/tree-builder/treeview.js" ></script>
<script type="text/javascript" src="{{MEDIA_URL}}js/tree-builder/jktreeview.js" ></script>

<script type="text/javascript">
var oaktree=new jktreeview("tree");
{% for q, value in ques.items %}
    var q_{{q.question.id}} = oaktree.addItem("{{q.question.question}}", "", "{{q.question.get_url}}");
    {% for qt in value %}
        {% if not qt.parent_question %}
            var q_{{qt.question.id}} = oaktree.addItem("{{qt.parent_value}} - {{qt.question.question}}", "", "{{qt.question.get_url}}");
        {% else %}
            var q_{{qt.question.id}} = oaktree.addItem("{{qt.parent_value}} - {{qt.question.question}}", q_{{qt.parent_question.id}}, "{{qt.question.get_url}}");
        {% endif %}
    {% endfor %}
{% endfor %}
oaktree.treetop.draw(); //REQUIRED LINE: Initalize tree

</script>



<script type="text/javascript">

$('.deletebin').click(function(){
    var k = this.id
    var width=650;
    var height=400;
    var onsuccess = function(data, textStatus, xhr){
        $('#deletebin').html(data);
        var dialog=$('#deletebin').dialog({modal:true, title:'Delete Confirmation',width:width, height:height, resizable:true});
    };
    var onerror=function(xhr, textStatus, error){
        $('#deletebin').html(xhr.responseText);
        var dialog = $('#deletebin').dialog({modal:true, title:'Delete Confirmation', width:width, height:height, resizable:true});
    };
    var url= "/question/delete/"+k;
    $.ajax({
        type: 'GET',
        url:url,
        data: '',
        success:onsuccess,
        error: onerror
    });
    return false;
});
        
</script>
{% endblock %}
