{% extends "analytics/base.html" %}
{% load order_tags %}
{% block content %}
{% if errors %}
<div class="orders_msg rc5">
  <div class="rc5 error">
    <ul style="list-style-type:disc; padding-left:10px;">
      <li>{{errors}}</li>
    </ul>
  </div>
</div>
{% endif %}

{% daterange title search_trend from_date to_date request "" "call_online" %}
<div class="clear">&nbsp;</div>
<div class="chkbox_list floating_container">
  <form method='GET' action="/reports/call_online_report/search/">
    <table>
      <tr>
        <td><input type="checkbox" id="id_phone_vs_web" name="phone_vs_web" value="True"  checked>
          Phone vs Online<br>
          <input type="checkbox" id="id_contribution" name="contribution" value="True" checked >
          % Contribution<br>
          <input type="checkbox" id="id_invoiced" name="invoiced" value="True" checked >
          % Invoiced (booking to invoice)<br>
          <input type="checkbox" id="id_asp" name="ASP" value="True" checked >
          ASP (Total Value / Total qty )<br>
          <input type="checkbox" id="id_ats" name="ATS" value="True" checked >
          ATS (Total Value / Total no. of orders)<br>
          <input type="checkbox" id="id_basket_size" name="basket_size" value="True" checked >
          Basket size (Total qty / total order)<br>
        </td>
      </tr>
    </table>
  </form>
</div>
{%if to_show%}
<table width="100%" class="floating_container">
  <tr>
  
  <td width="50%"><table class="tbl_order">
      <tr>
        <th></th>
        <th></th>
        <th>Phone</th>
        <th>Online</th>
        <th>Total</th>
      </tr>
      {%if total_visits%}
      <tr>
        <td>Visitors/Call</td>
        <td></td>
        <td class="ra">-</td>
        <td class="ra">{{total_visits}}</td>
        <td class="ra">-</td>
      </tr>
      <tr>
        <td>Conversion Rate</td>
        <td>Order</td>
        <td class="ra">{{visit_conversion.0.0}}</td>
        <td class="ra">{{visit_conversion.0.1}}%</td>
        <td class="ra">{{visit_conversion.0.2}}</td>
      </tr>
      {%endif%}
      <tr class="{%cycle "row1" "row2" %}">
        <td rowspan="3">Orders Booked</td>
        <td>Order</td>
        <td class="ra">{{order_booking.0.0}}</td>
        <td class="ra">{{order_booking.0.1}}</td>
        <td class="ra">{{order_booking.0.2}}</td>
      </tr>
      <tr class="{%cycle "row1" "row2" %}">
        <td>Quantity</td>
        <td class="ra">{{order_booking.1.0}}</td>
        <td class="ra">{{order_booking.1.1}}</td>
        <td class="ra">{{order_booking.1.2}}</td>
      </tr>
      <tr class="{%cycle "row1" "row2" %}">
        <td>Value</td>
        <td class="ra">{{order_booking.2.0}}</td>
        <td class="ra">{{order_booking.2.1}}</td>
        <td class="ra">{{order_booking.2.2}}</td>
      </tr>
      
      <tr class="{%cycle "row1" "row2" %}">
        <td rowspan="3">Conversion Rate</td>
        <td>Order</td>
        <td class="ra">{{order_conversion.0.0}}%</td>
        <td class="ra">{{order_conversion.0.1}}%</td>
        <td class="ra">{{order_conversion.0.2}}%</td>
      </tr>
      <tr class="{%cycle "row1" "row2" %}">
        <td>Quantity</td>
        <td class="ra">{{order_conversion.1.0}}%</td>
        <td class="ra">{{order_conversion.1.1}}%</td>
        <td class="ra">{{order_conversion.1.2}}%</td>
      </tr>
      <tr class="{%cycle "row1" "row2" %}">
        <td>Value</td>
        <td class="ra">{{order_conversion.2.0}}%</td>
        <td class="ra">{{order_conversion.2.1}}%</td>
        <td class="ra">{{order_conversion.2.2}}%</td>
      </tr>
      <tr class="{%cycle "row1" "row2" %}">
        <td rowspan="3">Payment Realisation</td>
        <td>Order</td>
        <td class="ra">{{payment_realisation.0.0}}</td>
        <td class="ra">{{payment_realisation.0.1}}</td>
        <td class="ra">{{payment_realisation.0.2}}</td>
      </tr>
      <tr class="{%cycle "row1" "row2" %}">
        <td>Quantity</td>
        <td class="ra">{{payment_realisation.1.0}}</td>
        <td class="ra">{{payment_realisation.1.1}}</td>
        <td class="ra">{{payment_realisation.1.2}}</td>
      </tr>
      <tr class="{%cycle "row1" "row2" %}">
        <td>Value</td>
        <td class="ra">{{payment_realisation.2.0}}</td>
        <td class="ra">{{payment_realisation.2.1}}</td>
        <td class="ra">{{payment_realisation.2.2}}</td>
      </tr>
      <tr class="{%cycle "row1" "row2" %}">
        <td rowspan="3">Conversion Rate</td>
        <td>Order</td>
        <td class="ra">{{paid_conversion.0.0}}%</td>
        <td class="ra">{{paid_conversion.0.1}}%</td>
        <td class="ra">{{paid_conversion.0.2}}%</td>
      </tr>
      <tr class="{%cycle "row1" "row2" %}">
        <td>Quantity</td>
        <td class="ra">{{paid_conversion.1.0}}%</td>
        <td class="ra">{{paid_conversion.1.1}}%</td>
        <td class="ra">{{paid_conversion.1.2}}%</td>
      </tr>
      <tr class="{%cycle "row1" "row2" %}">
        <td>Value</td>
        <td class="ra">{{paid_conversion.2.0}}%</td>
        <td class="ra">{{paid_conversion.2.1}}%</td>
        <td class="ra">{{paid_conversion.2.2}}%</td>
      </tr>
      <tr class="{%cycle "row1" "row2" %}">
        <td rowspan="3">Invoiced</td>
        <td>Order</td>
        <td class="ra">{{invoiced.0.0}}</td>
        <td class="ra">{{invoiced.0.1}}</td>
        <td class="ra">{{invoiced.0.2}}</td>
      </tr>
      <tr class="{%cycle "row1" "row2" %}">
        <td>Quantity</td>
        <td class="ra">{{invoiced.1.0}}</td>
        <td class="ra">{{invoiced.1.1}}</td>
        <td class="ra">{{invoiced.1.2}}</td>
      </tr>
      <tr class="{%cycle "row1" "row2" %}">
        <td>Value</td>
        <td class="ra">{{invoiced.2.0}}</td>
        <td class="ra">{{invoiced.2.1}}</td>
        <td class="ra">{{invoiced.2.2}}</td>
      </tr>
      <tr class="{%cycle "row1" "row2" %}">
        <td rowspan="3">%Contribution</td>
        <td>Bookings</td>
        <td class="ra">{{contribution.0.0}}%</td>
        <td class="ra">{{contribution.0.1}}%</td>
        <td class="ra">{{contribution.0.2}}</td>
      </tr>
      <tr class="{%cycle "row1" "row2" %}">
        <td>Realisation</td>
        <td class="ra">{{contribution.1.0}}%</td>
        <td class="ra">{{contribution.1.1}}%</td>
        <td class="ra">{{contribution.1.2}}</td>
      </tr>
      <tr class="{%cycle "row1" "row2" %}">
        <td>Invoiced</td>
        <td class="ra">{{contribution.2.0}}%</td>
        <td class="ra">{{contribution.2.1}}%</td>
        <td class="ra">{{contribution.2.2}}</td>
      </tr>
      <tr class="{%cycle "row1" "row2" %}">
        <td rowspan="1"> % invoiced(booking to invoiced)</td>
        <td>Bookings</td>
        <td class="ra">{{booked_to_invoiced.0}}%</td>
        <td class="ra">{{booked_to_invoiced.1}}%</td>
        <td class="ra">{{booked_to_invoiced.2}}%</td>
      </tr>
      <tr class="{%cycle "row1" "row2" %}">
        <td rowspan="3">ASP</td>
        <td>Bookings</td>
        <td class="ra">{{ASP.0.0}}</td>
        <td class="ra">{{ASP.0.1}}</td>
        <td class="ra">{{ASP.0.2}}</td>
      </tr>
      <tr class="{%cycle "row1" "row2" %}">
        <td>Realisation</td>
        <td class="ra">{{ASP.1.0}}</td>
        <td class="ra">{{ASP.1.1}}</td>
        <td class="ra">{{ASP.1.2}}</td>
      </tr>
      <tr class="{%cycle "row1" "row2" %}">
        <td>Invoiced</td>
        <td class="ra">{{ASP.2.0}}</td>
        <td class="ra">{{ASP.2.1}}</td>
        <td class="ra">{{ASP.2.2}}</td>
      </tr>
      <tr class="{%cycle "row1" "row2" %}">
        <td rowspan="3">ATS</td>
        <td>Bookings</td>
        <td class="ra">{{ATS.0.0}}</td>
        <td class="ra">{{ATS.0.1}}</td>
        <td class="ra">{{ATS.0.2}}</td>
      </tr>
      <tr class="{%cycle "row1" "row2" %}">
        <td>Realisation</td>
        <td class="ra">{{ATS.1.0}}</td>
        <td class="ra">{{ATS.1.1}}</td>
        <td class="ra">{{ATS.1.2}}</td>
      </tr>
      <tr class="{%cycle "row1" "row2" %}">
        <td>Invoiced</td>
        <td class="ra">{{ATS.2.0}}</td>
        <td class="ra">{{ATS.2.1}}</td>
        <td class="ra">{{ATS.2.2}}</td>
      </tr>
      <tr class="{%cycle "row1" "row2" %}">
        <td rowspan="3">Basket size</td>
        <td>Bookings</td>
        <td class="ra">{{basket.0.0}}</td>
        <td class="ra">{{basket.0.1}}</td>
        <td class="ra">{{basket.0.2}}</td>
      </tr>
      <tr class="{%cycle "row1" "row2" %}">
        <td>Realisation</td>
        <td class="ra">{{basket.1.0}}</td>
        <td class="ra">{{basket.1.1}}</td>
        <td class="ra">{{basket.1.2}}</td>
      </tr>
      <tr class="{%cycle "row1" "row2" %}">
        <td>Invoiced</td>
        <td class="ra">{{basket.2.0}}</td>
        <td class="ra">{{basket.2.1}}</td>
        <td class="ra">{{basket.2.2}}</td>
      </tr>
      
    </table></td>
  <td width="20"></td>
    <td valign="top"><div id="visualization"></div>
      <!--<img src="http://chart.apis.google.com/chart?chf=bg,lg,0,EFEFEF,0&chxl=0:|bookings|paid|invoiced&chxp=0,17,50,84&chxr=0,0,100|1,0,{{maximum}}&chxt=x,y&chbh=18,1,13&chs=558x521&cht=bvg&chco=FF6342,ADDE63,63C6DE&chds=0,{{maximum}},0,{{maximum}},0,{{maximum}}&chd=t:{{g_data.0.0}},{{g_data.0.1}},{{g_data.0.2}}|{{g_data.1.0}},{{g_data.1.1}},{{g_data.1.2}}|{{g_data.2.0}},{{g_data.2.1}},{{g_data.2.2}}&chdl=Order('00)|Quantity('00)|Value(L)&chm=D,FF0000,2,-1,0.8|N,000000,2,-1,11&chtt=Booked,+Paid,+Invoiced+Summary" width="440" alt="Vertical bar chart" />-->
    </td>
  </tr>
</table>
<div class="clear padt10"></div>
<table class="tbl_order">
  <tr>
    <td><img src="http://chart.apis.google.com/chart?chxl=0:|Booking|Orders:+{{order_booking.0.0}}|Value:+{{g_data.3.0}}L|Conversion:+{{order_conversion.0.0}}%|Paid|Orders:+{{payment_realisation.0.0}}|Value:+{{g_data.3.1}}L|Conversion:+{{paid_conversion.0.0}}%|Invoiced|Orders:+{{invoiced.0.0}}|Value:+{{g_data.3.2}}L&chxp=0,101.5,93.55,86,78.35,63,55.25,47.5,39.75,24.5,16.75,9.25&chxr=0,-10,105|1,0,0&chxs=0,676767,11.5,-0.5,t,676767|1,676767,11.5,0,_,676767&chxtc=0,180&chxt=y,x&chbh=27,4,35&chs=440x480&cht=bhg&chco=4D89F9,C6D9FD,FF9900,FF9900&chds=0,155,-6,160,-7,100,-10,100&chd=t:35,35,35|25,25,25|10,10,10|5,5,5&chtt=Funnel+summary+Phone" width="440" height="480" alt="Funnel summary" /> </td>
    <td><img src="http://chart.apis.google.com/chart?chxl=0:|Booking|Orders:+{{order_booking.0.1}}|Value:+{{g_data.4.0}}L|Conversion:+{{order_conversion.0.1}}%|Paid|Orders:+{{payment_realisation.0.1}}|Value:+{{g_data.4.1}}L|Conversion:+{{paid_conversion.0.1}}%|Invoiced|Orders:+{{invoiced.0.1}}|Value:+{{g_data.4.2}}L&chxp=0,101.5,93.55,86,78.35,63,55.25,47.5,39.75,24.5,16.75,9.25&chxr=0,-10,105|1,0,0&chxs=0,676767,11.5,-0.5,t,676767|1,676767,11.5,0,_,676767&chxtc=0,180&chxt=y,x&chbh=27,4,35&chs=440x480&cht=bhg&chco=4D89F9,C6D9FD,FF9900,FF9900&chds=0,155,-6,160,-7,100,-10,100&chd=t:35,35,35|25,25,25|10,10,10|5,5,5&chtt=Funnel+summary+Online" width="440" height="480" alt="Funnel summary" /> </td>
  </tr>
</table>
{%endif%}
{%endblock%}
{% block script_footer %}
{{block.super}}
<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script type="text/javascript">
    google.load('visualization', '1', {packages: ['corechart']});
    function drawVisualization() {
    // Create and populate the data table.
    var data = new google.visualization.DataTable();
    var raw_data = [["# ('00s)" ,{{g_data.0.0}}, {{g_data.0.1}}, {{g_data.0.2}}],
    ["Quantity ('00s)", {{g_data.1.0}}, {{g_data.1.1}}, {{g_data.1.2}}],
    ['Value (lakh Rs)', {{g_data.2.0}}, {{g_data.2.1}}, {{g_data.2.2}}]];
    var years = ['Booked Orders', 'Paid Orders', 'Invoiced Orders'];
    data.addColumn('string', 'Order Status');
    for (var i = 0; i  < raw_data.length; ++i) {
                                                                                                                                                                         data.addColumn('number', raw_data[i][0]);    
    }
    data.addRows(years.length);
    
    for (var j = 0; j < years.length; ++j) {    
    data.setValue(j, 0, years[j].toString());    
    }
    for (var i = 0; i  < raw_data.length; ++i) {
        for (var j = 1; j  < raw_data[i].length; ++j) {
            data.setValue(j-1, i+1, raw_data[i][j]);    
        }
    }
    // Create and draw the visualization.
    new google.visualization.ColumnChart(document.getElementById('visualization')).
    draw(data,{title:"Order Pipeline (#, Quantity, Value) ", width:500, height:600});
    }
    google.setOnLoadCallback(drawVisualization);
    </script>
{% endblock %} 
